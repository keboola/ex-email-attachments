version: "2"

services:

  app:
    build: .
    image: keboola/pigeon
    tty: true
    stdin_open: true

  tests:
    image: keboola/pigeon
    volumes:
      - ./:/code
      - ./docker/php/php.ini:/usr/local/etc/php/php.ini
    entrypoint: /code/vendor/bin/phpunit
    environment:
      - ACCESS_KEY_ID
      - BUCKET
      - DYNAMO_TABLE
      - EMAIL_DOMAIN
      - REGION
      - RULE_SET
      - SECRET_ACCESS_KEY
      - STACK_NAME

  dev:
    build: .
    image: keboola/pigeon
    tty: true
    stdin_open: true
    volumes:
      - ./:/code
    environment:
      - KBC_PROJECTID